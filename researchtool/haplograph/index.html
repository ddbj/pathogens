<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta rel=canonical href=https://ddbj.github.io/pathogens/><meta name=SKYPE_TOOLBAR content="SKYPE_TOOLBAR_PARSER_COMPATIBLE"><title>SARS-CoV-2 HaploGraph:COVID-19 データポータル</title>
<meta name=description content='「COVID-19データポータルJAPAN」は、研究に役立つ新型コロナウイルスのデータやサービスを集約し提供します。本システムはEuropean COVID-19 Data Portalの協力の元、JAIRO Cloudの基盤を利用して、国内の多数の機関の援助を受けて公開しています。新型コロナウイルスへの生活への影響や予防については、厚生労働省特設サイトをご覧ください。'><meta http-equiv=content-language content="ja"><meta name=keywords content="COVID-19,研究データ"><link rel=manifest href=https://ddbj.github.io/pathogens/manifest.json><meta name=og:url content="/"><meta name=og:type content="website"><meta name=og:image content="/img/CV19DP-jp_logo.svg"><meta name=og:title content="COVID-19 データポータル"><meta name=og:description content="「COVID-19データポータルJAPAN」は、研究に役立つ新型コロナウイルスのデータやサービスを集約し提供します。本システムはEuropean COVID-19 Data Portalの協力の元、JAIRO Cloudの基盤を利用して、国内の多数の機関の援助を受けて公開しています。新型コロナウイルスへの生活への影響や予防については、厚生労働省特設サイトをご覧ください。"><link rel=apple-touch-icon sizes=180x180 href=https://ddbj.github.io/pathogens/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ddbj.github.io/pathogens/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ddbj.github.io/pathogens/favicon-16x16.png><link rel="shortcut icon" href=https://ddbj.github.io/pathogens/img/favicon.ico><meta property="og:url" content="https://ddbj.github.io/pathogens/researchtool/haplograph/"><meta property="og:site_name" content="COVID-19 データポータル"><meta property="og:title" content="SARS-CoV-2 HaploGraph"><meta property="og:description" content="SARS-CoV-2 HaploGraph SARS-CoV-2 HaploGraph Dataset dataname Haplotypes Multiple choice: Cmd + Click Ctrl + Click Trace Duration Haplotype Prefecture First day Last day Duration Total"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="researchtool"><meta property="og:image" content="https://ddbj.github.io/img/CV19DP-jp_logo.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ddbj.github.io/img/CV19DP-jp_logo.svg"><meta name=twitter:title content="SARS-CoV-2 HaploGraph"><meta name=twitter:description content="SARS-CoV-2 HaploGraph SARS-CoV-2 HaploGraph Dataset dataname Haplotypes Multiple choice: Cmd + Click Ctrl + Click Trace Duration Haplotype Prefecture First day Last day Duration Total"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css integrity=sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd crossorigin=anonymous><link rel=stylesheet href=https://ddbj.github.io/pathogens/main.min.de5cc007ae1c9c054eb5261744b2844c555f0ea007e677e31d879881fb2846f7.css><link rel=stylesheet href=https://ddbj.github.io/pathogens/css/substyle.css><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css integrity=sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk crossorigin=anonymous><link rel=stylesheet href=https://unpkg.com/jpn.css@latest/dist/bootstrap/jpn.min.css><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin=anonymous></script><script>$(function(){$(".navbar-primary-links li.nav-item").hover(function(){$("ul.dropdwn-menu",this).show()},function(){$("ul.dropdwn-menu",this).hide()})}),$(function(){window.matchMedia("(max-width:768px)").matches&&$(".navbar-primary-links li.nav-item").click(function(){$("ul.dropdwn-menu",this).toggle()})}),jQuery(function(e){var t=e("#pageTop");t.hide(),e(window).scroll(function(){e(this).scrollTop()>500?t.fadeIn():t.fadeOut()}),t.click(function(){return e("body,html").animate({scrollTop:0},500),!1})}),jQuery(function(e){e(".fy").click(function(){e(".fy .accordion-title").toggleClass("open",400),e(this).nextUntil(".sy").slideToggle(300,function(){})})}),jQuery(function(e){e(".sy").click(function(){e(".sy .accordion-title").toggleClass("open",400),e(this).nextUntil(".ty").slideToggle(300,function(){})})})</script></head><body><a class=visually-hidden-focusable href=#content>Skip to main content</a><nav class="navbar navbar-expand-lg navbar-light bg-white pb-0"><div class=container><div class="d-flex navbar-brand"><a href=https://ddbj.github.io/pathogens/><img class="mt-1 me-lg-3" src=https://ddbj.github.io/pathogens/img/CDP-19_Japan_logo-jp.svg alt="COVID-19 データポータルJAPAN"></a></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarMobile aria-controls=navbarMobile aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="d-flex flex-column align-items-end collapse navbar-collapse"><div class="collapse navbar-collapse"><ul class="navbar-nav ml-auto navbar-top"><li class=nav-item><a class=nav-link href=https://ddbj.github.io/pathogens/events/>Events</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" role=button data-bs-toggle=dropdown aria-expanded=false><i class="bi bi-globe2"></i> JP</a><ul class="dropdown-menu dropdown-menu-end nav-languages"><li><a class=dropdown-item href=https://ddbj.github.io/pathogens/researchtool/haplograph/><i class="bi bi-check-circle"></i>
<span lang=ja>日本語</span></a></li><li><a class=dropdown-item href=https://ddbj.github.io/pathogens/en/researchtool/haplograph/><i class="bi bi-circle"></i>
<span lang=en>English</span></a></li></ul></li></ul></div></div></div></nav><nav class="navbar navbar-expand-lg navbar-light pt-0 pb-1"><div class=container><div class="collapse navbar-collapse" id=navbarMobile><div class=d-lg-none><div class=main_menu_item><a href=https://ddbj.github.io/pathogens/>TOP</a></div><div class="main_menu_item pb-1"><a href=#aboutMobile data-bs-toggle=collapse role=button aria-expanded=false aria-controls=aboutMobile>サイトについて <i class="bi bi-caret-down-fill small"></i></a><div class="collapse main_menu_item_sub ps-4" id=aboutMobile><a class=d-block href=https://ddbj.github.io/pathogens/about/overview/>概要</a>
<a class=d-block href=https://ddbj.github.io/pathogens/about/ourpartners/>連携体制</a>
<a class=d-block href=https://ddbj.github.io/pathogens/about/updates/>更新履歴</a>
<a class=d-block href=https://ddbj.github.io/pathogens/about/supportfeedback/>お問い合わせ</a></div></div><div class="main_menu_item pb-1"><a href=#researchdataMobile data-bs-toggle=collapse role=button aria-expanded=false aria-controls=researchdataMobile>研究データ <i class="bi bi-caret-down-fill small"></i></a><div class="collapse main_menu_item_sub ps-4" id=researchdataMobile><a class=d-block href=https://ddbj.github.io/pathogens/researchdata/genotrans/>遺伝子・配列情報</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchdata/proteomics/>タンパク質情報</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchdata/resource/>リソース情報</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchdata/imagingdata/>画像情報</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchdata/literature/>文献情報</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchdata/diseaseinfo/>疾患情報</a></div></div><div class="main_menu_item pb-1"><a href=#researchtoolMobile data-bs-toggle=collapse role=button aria-expanded=false aria-controls=researchtoolMobile>研究ツール <i class="bi bi-caret-down-fill small"></i></a><div class="collapse main_menu_item_sub ps-4" id=researchtoolMobile><a class=d-block href=https://ddbj.github.io/pathogens/researchtool/bioinfomatics/>バイオインフォマティクス</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchtool/submission/>データの投稿</a>
<a class=d-block href=https://ddbj.github.io/pathogens/researchtool/haplograph/>SARS-CoV-2 HaploGraph</a></div></div><div class=main_menu_item><a href=https://ddbj.github.io/pathogens/><a href=https://www.covid19dataportal.org target=_blank style=font-weight:100><img src=https://ddbj.github.io/pathogens/img/link.png alt=リンクアイコン style=width:18px;margin-right:6px>European Portal</a></div></div><hr><ul class="d-lg-none navbar-nav nav-top"><li class="nav-item py-2 dropdown languages-mobile"><a href=#languageMobile class=py-2 data-bs-toggle=collapse role=button aria-expanded=false aria-controls=languageMobile><i class="bi bi-globe2"></i> JP
<i class="bi bi-caret-down-fill small"></i></a><div class="collapse ps-2 pt-1" id=languageMobile><a class=dropdown-item href=https://ddbj.github.io/pathogens/researchtool/haplograph/><i class="bi bi-check-circle"></i>
<span lang=ja>日本語</span>
</a><a class=dropdown-item href=https://ddbj.github.io/pathogens/en/researchtool/haplograph/><i class="bi bi-circle"></i>
<span lang=en>English</span></a></div></li><hr><li class=nav-item><a class=nav-link href=https://ddbj.github.io/pathogens/events/>Events</a></li></ul></div></div></nav><div class="container mb-3 d-none d-lg-block"><div class="row row-cols-auto main_menu"><div class="col-auto main_menu_item"><a href=https://ddbj.github.io/pathogens/>TOP</a></div><div class="col-auto main_menu_item"><a class=dropdown-toggle href=# id=aboutMenu data-bs-auto-close=outside data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>サイトについて</a><div class="dropdown-menu main_menu_item_sub" aria-labelledby=aboutMenu><a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/about/overview/>概要</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/about/ourpartners/>連携体制</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/about/updates/>更新履歴</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/about/supportfeedback/>お問い合わせ</a></div></div><div class="col-auto main_menu_item"><a class=dropdown-toggle href=# id=researchdataMenu data-bs-auto-close=outside data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>研究データ</a><div class="dropdown-menu main_menu_item_sub" aria-labelledby=researchdataMenu><a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/genotrans/>遺伝子・配列情報</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/proteomics/>タンパク質情報</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/resource/>リソース情報</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/imagingdata/>画像情報</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/literature/>文献情報</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchdata/diseaseinfo/>疾患情報</a></div></div><div class="col-auto main_menu_item"><a class=dropdown-toggle href=# id=researchtoolMenu data-bs-auto-close=outside data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>研究ツール</a><div class="dropdown-menu main_menu_item_sub" aria-labelledby=researchtoolMenu><a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchtool/bioinfomatics/>バイオインフォマティクス</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchtool/submission/>データの投稿</a>
<a class="dropdown-item m-0" href=https://ddbj.github.io/pathogens/researchtool/haplograph/>SARS-CoV-2 HaploGraph</a></div></div><div class="col-auto main_menu_item"><a href=https://ddbj.github.io/pathogens/><a href=https://www.covid19dataportal.org target=_blank style=font-weight:100><img src=https://ddbj.github.io/pathogens/img/link.png alt=リンクアイコン style=width:18px;margin-right:6px>European Portal</a></div></div></div><div class=header style="background-image:linear-gradient(to bottom,rgba(55,174,148,.52),rgba(55,174,148,.73)),url(https://ddbj.github.io/pathogens/img/csm_coronavirus_mc.jpg)"><div class=container><h2>SARS-CoV-2 HaploGraph</h2></div></div><nav aria-label=breadcrumbs class=breadcrumbs><div class=container><ol><li><a href=https://ddbj.github.io/pathogens/>ホーム</a></li><li><a href=https://ddbj.github.io/pathogens/researchtool/>研究ツール</a></li><li>SARS-CoV-2 HaploGraph</li></ol></div></nav><div class="container content" id=content><main><div class=container><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>SARS-CoV-2 HaploGraph</title>
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css><script src=https://d3js.org/d3.v5.min.js></script><script>const data={canvas:{width:1200,height:1e3,magic:5},margin:{top:10,bottom:90,left:90,right:10},lang:"ja",dataname:"2nd wave B.1.1.284",wavename:"2W",wavelabel:"2nd wave",files:{haplotypes:"data/2W-durations-50p.tsv",selectlist:"data/2W-selectlist.json",mutations:"data/2W-mutations.json",annotations:"data/annotations.json",districts:"data/districts.json"},datasets:[{dataname:"2nd wave B.1.1.284",wavename:"2W",wavelabel:"2nd wave",haplotypes:"data/2W-durations-50p.tsv",selectlist:"data/2W-selectlist.json",mutations:"data/2W-mutations.json"},{dataname:"3rd wave B.1.1.214",wavelabel:"3rd wave",wavename:"3W",haplotypes:"data/3W-durations-50p.tsv",selectlist:"data/3W-selectlist.json",mutations:"data/3W-mutations.json"},{dataname:"4th wave Alpha B.1.1.7",wavelabel:"4th wave",wavename:"4W",haplotypes:"data/4W-durations-50p.tsv",selectlist:"data/4W-selectlist.json",mutations:"data/4W-mutations.json"},{dataname:"5th wave Delta AY.29",wavelabel:"5th wave",wavename:"5W",haplotypes:"data/5W-durations-50p.tsv",selectlist:"data/5W-selectlist.json",mutations:"data/5W-mutations.json"}],resolutions:[{id:"resolution-hd",canvas:{width:1920,height:1e3,magic:3}},{id:"resolution-4k",canvas:{width:3840,height:1e3,magic:5}},{id:"resolution-8k",canvas:{width:7680,height:1e3,magic:11}}],pallet:d3.scaleOrdinal(d3.schemeTableau10),nodeR:5,edgeW:2,haplotypes:{set:new Set,all:[],selected:[],visible:[],emerged:[]}};setup();function setup(){wipeAll(),data.scaleX=d3.scaleTime().range([data.margin.left,data.canvas.width-data.margin.right]),data.scaleY=d3.scaleLinear().range([data.canvas.height-data.margin.bottom,data.margin.top]),Promise.all([loadDistricts(),loadGenome(),loadMutations(),loadSelectlist(),loadHaplotypes()]).then(()=>{initHaplotypes(),prepareHTML(),drawAxes(),drawArea(),updateAll()})}function initHaplotypes(){const e=Array.from(data.haplotypes.set);data.haplotypes.all=e,data.haplotypes.selected=e,data.haplotypes.visible=e,data.haplotypes.emerged=e.map(e=>{const t=data.points.filter(t=>t.haplotype==e),n=d3.min(t,e=>e.firstday);return t.filter(e=>e.firstday==n).shift()}).filter(e=>e)}function updateAll(){updateGenome(),updateChart()}function updateGenome(){drawGenome(),drawMutations()}function updateChart(){drawTrace(),drawHaplotype(),toggleTrace(),toggleDuration()}function wipeAll(){d3.select("svg#genome").selectAll("*").remove(),d3.select("svg#chart").selectAll("*").remove()}function changeHaplotypes(){this.options?(data.haplotypes.selected=Array.from(this.options).filter(e=>e.selected).map(e=>e.value),(data.haplotypes.selected.includes("All")||data.haplotypes.selected.size==0)&&(data.haplotypes.selected=data.haplotypes.all)):data.haplotypes.selected=data.haplotypes.all,data.haplotypes.visible=data.haplotypes.selected,updateAll()}function brushHaplotypes(){if(d3.event.selection){const[n,s]=d3.event.selection,e=Date.parse(data.scaleX.invert(n)),t=Date.parse(data.scaleX.invert(s)),o=data.points.filter(n=>checkSelector("#duration")?n.firstday>e&&n.firstday<t||n.lastday>e&&n.lastday<t:n.firstday>e&&n.firstday<t).filter(e=>{if(data.haplotypes.selected.includes(e.haplotype))return e});data.haplotypes.visible=uniqHaplotypes(o)}else data.haplotypes.visible=data.haplotypes.selected;updateAll()}function pickPrefecture(e){wipePrefecture();const t=Object.values(data.prefectures).filter(t=>t.code==data.offset-e).shift(),n=data.points.filter(e=>e.prefecture==t.name).filter(e=>{if(data.haplotypes.selected.includes(e.haplotype))return e});data.haplotypes.visible=uniqHaplotypes(n),showPrefecture(t),updateAll()}function showPrefecture(e){const n=data.scaleY(2)-data.scaleY(1),t=data.scaleY(data.offset-e.code),s=data.scaleY(data.offset-e.code-1);d3.select("svg#chart").append("g").attr("class","prefectures"),d3.select("svg#chart").select(".prefectures").append("rect").attr("class","prefecture").attr("x",data.margin.left).attr("y",t+n/2+3).attr("width",data.canvas.width-(data.margin.left+data.margin.right)).attr("height",s-t-6).style("fill","#999999").style("opacity",.3)}function wipePrefecture(){wipeSelector(".prefectures")}function uniqHaplotypes(e){let t=new Set;return e.map(e=>t.add(e.haplotype)),Array.from(t).sort()}function toggleHaplotype(e){data.haplotypes.selected[0]==e&&!data.haplotypes.selected[1]?data.haplotypes.visible=data.haplotypes.selected:data.haplotypes.visible=[e],updateAll()}function toggleLineage(){checkSelector("#lineage")?(showSelector(".lineages"),d3.selectAll(".firstday.emerged").style("stroke","#666666")):(hideSelector(".lineages"),d3.selectAll(".firstday.emerged").style("stroke",""))}function toggleTrace(){checkSelector("#trace")?(showSelector(".traces"),showSelector(".firstday.traced")):(hideSelector(".traces"),hideSelector(".firstdaqy.traced"))}function toggleDuration(){checkSelector("#duration")?(showSelector(".durations"),showSelector(".lastdays")):(hideSelector(".durations"),hideSelector(".lastdays"))}function toggleLang(){data.lang=="en"?(data.lang="ja",d3.select("html").attr("lang","ja"),d3.select("#help-link").attr("href","https://ktym.github.io/covid19/help-ja"),wipeSelector(".axis-y"),drawAxisY()):(data.lang="en",d3.select("html").attr("lang","en"),d3.select("#help-link").attr("href","https://ktym.github.io/covid19/help-en"),wipeSelector(".axis-y"),drawAxisY())}function changeDataset(){const t=Array.from(this.options).filter(e=>e.selected).shift();data.wavelabel=t.value;const e=data.datasets.filter(e=>e.wavelabel==data.wavelabel).shift();data.dataname=e.dataname,data.wavename=e.wavename,data.files.haplotypes=e.haplotypes,data.files.selectlist=e.selectlist,data.files.mutations=e.mutations,data.haplotypes.all=new Set,setup()}function loadDistricts(){return d3.json(data.files.districts).then(e=>{data.areas=e.regions,data.prefectures=e.locations,data.offset=Object.keys(data.prefectures).length+1})}function loadGenome(){return d3.json(data.files.annotations).then(e=>{data.genome=e.Genome.shift(),data.genes=e.Genes})}function loadMutations(){return d3.json(data.files.mutations).then(e=>{data.mutations=e})}function loadSelectlist(){return d3.json(data.files.selectlist).then(e=>{data.selectlist=e.haplotypes})}function loadHaplotypes(){const e=Date.parse("2022-03-10")-Date.parse("2022-03-09");return d3.tsv(data.files.haplotypes,e=>(data.haplotypes.set.add(e.haplotype),{haplotype:e.haplotype,firstday:Date.parse(e.first),lastday:Date.parse(e.last),duration:parseInt(e.duration),total:parseInt(e.total),prefecture:e.prefecture})).then(t=>{data.points=t,data.scaleX.domain([d3.min(t,e=>e.firstday)-e,d3.max(t,e=>e.lastday)+e]),data.scaleY.domain(d3.extent(t,e=>data.prefectures[e.prefecture].code))})}function prepareHTML(){let e=data.selectlist;e.unshift("All"),d3.select("#haplotype").selectAll("option").data(e).join("option").attr("value",e=>e).text(e=>e),d3.select("#dataset").selectAll("option").data(data.datasets).join("option").attr("value",e=>e.wavelabel).text(e=>e.wavelabel),d3.select("svg#genome").attr("width",data.canvas.width).attr("viewBox",`0 0 ${data.canvas.width} 100`),d3.select("svg#chart").attr("width",data.canvas.width).attr("viewBox",`0 0 ${data.canvas.width} 1000`),d3.select("#dataname").text(data.dataname),d3.select("#recommended-width").text(data.canvas.width),d3.select("#infobox-haplotype").style("margin-left",`${data.margin.left}px`),d3.select("#haplotype").on("change",changeHaplotypes),d3.select("#dataset").on("change",changeDataset),d3.select("#trace").on("change",toggleTrace),d3.select("#duration").on("change",toggleDuration),d3.select(window).on("resize",updateGenome),d3.select("#resolution-hd").on("click",changeResolution),d3.select("#resolution-4k").on("click",changeResolution),d3.select("#resolution-8k").on("click",changeResolution),d3.select("#lang").on("click",toggleLang)}function drawAxes(){drawAxisX(),drawAxisY(),drawGridX(),drawGridY()}function drawAxisX(){const e=d3.axisBottom(data.scaleX).ticks(50).tickSize(0).tickFormat(d3.timeFormat("%Y-%m-%d"));d3.select("svg#chart").append("g").attr("class","axis-x").call(e).selectAll("text").style("text-anchor","start").attr("transform","rotate(90)").attr("x",data.canvas.height-data.margin.bottom).attr("y",0).attr("dx","1.5em").attr("dy",".35em")}function drawAxisY(){const e=Object.values(data.prefectures),t=d3.axisLeft(data.scaleY).tickPadding(5).ticks(data.offset,"c").tickSize(0).tickFormat(t=>{let n=e.filter(e=>e.code==data.offset-t).shift();return data.lang=="en"?n.name:n.label});d3.select("svg#chart").append("g").attr("class","axis-y").attr("transform",`translate(${[data.margin.left,0]})`).call(t).selectAll("text").on("click",pickPrefecture)}function drawGridX(){const e=d3.axisBottom(data.scaleX).ticks(50).tickSize(data.canvas.height-data.margin.bottom+10);d3.select("svg#chart").append("g").attr("class","axis-x-grid").call(e).selectAll("text").remove()}function drawGridY(){const e=d3.axisLeft(data.scaleY).ticks(data.offset,"c").tickSize(data.canvas.width-(data.margin.left+data.margin.right));d3.select("svg#chart").append("g").attr("class","axis-y-grid").attr("transform",`translate(${[data.canvas.width-data.margin.right,0]})`).call(e).selectAll("text").remove()}function drawArea(){const e=data.scaleY(2)-data.scaleY(1);d3.select("svg#chart").append("g").attr("class","areas");for(let t of data.areas){let n=data.scaleY(data.offset-data.prefectures[t.top].code),s=data.scaleY(data.offset-data.prefectures[t.bottom].code-1);d3.select("svg#chart").select(".areas").append("rect").attr("class","area").attr("x",data.margin.left).attr("y",n+e/2).attr("width",data.canvas.width-(data.margin.left+data.margin.right)).attr("height",s-n).attr("fill",data.pallet(t.label))}data.brushX=d3.brushX().extent([[data.margin.left,0],[data.canvas.width,data.canvas.height]]).on("end",brushHaplotypes),d3.select("svg#chart").select(".areas").call(data.brushX)}function drawGenome(){wipeGenome();const e=data.canvas.width;data.scaleG=d3.scaleLinear().range([data.margin.left,e]).domain([data.genome.lower,data.genome.upper]);const t=d3.axisBottom(data.scaleG).ticks(25).tickSize(5);d3.select("svg#genome").attr("width",e).attr("viewBox",`0 0 ${e+data.margin.right} 100`),d3.select("svg#genome").append("g").attr("class","axis-g").call(t).attr("transform",`translate(0, 80)`),d3.select("svg#genome").append("g").selectAll("rect.region").data(data.genes).join("rect").attr("class","region").attr("x",e=>data.scaleG(e.lower)).attr("y",e=>e.region!=""?50:55).attr("width",e=>data.scaleG(e.upper)-data.scaleG(e.lower)).attr("height",e=>e.region!=""?10:1).attr("stroke","black").attr("fill",e=>data.pallet(e.region)),d3.select("svg#genome").selectAll("text.region").data(data.genes).join("text").text(e=>e.region).attr("x",e=>data.scaleG(e.lower)).attr("y",75)}function wipeGenome(){d3.select("svg#genome").selectAll("g").remove(),d3.select("svg#genome").selectAll("text").remove()}function drawMutations(){wipeMutations();const t=d3.line();d3.select("svg#genome").append("g").selectAll("path.reference-mutation").data(data.mutations.Reference).join("path").attr("class","reference-mutation").attr("transform",e=>`translate(${data.scaleG(e.pos)},55)`).attr("d",d3.symbol().type(d3.symbolDiamond)).style("fill","#333333").style("opacity",.5);const e=uniqMutations();d3.select("svg#genome").append("g").selectAll("path.mutation").data(e).join("path").attr("class","mutation").attr("d",e=>t([[data.scaleG(e.pos),35],[data.scaleG(e.pos),50]])).style("stroke","#333333").style("fill","none").style("opacity",.3),d3.select("svg#genome").append("g").selectAll("circle.mutation").data(e).join("circle").attr("class","mutation").attr("r",data.nodeR).attr("cx",e=>data.scaleG(e.pos)).attr("cy",30).style("stroke","#333333").style("fill","#333333").style("opacity",.3)}function wipeMutations(){wipeSelector(".mutation"),wipeSelector(".reference-mutation")}function uniqMutations(){const e=new Map;return data.haplotypes.visible.map(t=>{data.mutations[t]?data.mutations[t].map(t=>e.set(t.str,t)):console.log(`ERROR: ${t} has no mutation data`)}),Array.from(e.values())}function drawHaplotype(){wipeHaplotype();const e=data.points.filter(e=>data.haplotypes.visible.includes(e.haplotype));drawDuration(e),drawLastday(e),drawFirstday(e),toggleDuration()}function wipeHaplotype(){wipeSelector(".firstdays"),wipeSelector(".lastdays"),wipeSelector(".durations")}function drawDuration(e){d3.select("svg#chart").append("g").attr("class","durations"),d3.select("svg#chart").select(".durations").selectAll("path.duration").data(e).join("path").attr("class",e=>data.haplotypes.emerged.includes(e)?"duration emerged":"duration traced").attr("fill","none").attr("stroke",e=>data.pallet(e.haplotype)).attr("stroke-width",e=>Math.log(e.total)).attr("d",e=>duration(e)).on("mouseover",showInfoboxDuration).on("click",e=>toggleHaplotype(e.haplotype))}function duration(e){return x1=data.scaleX(e.firstday)-data.canvas.magic,x2=data.scaleX(e.lastday)-data.canvas.magic,y=data.scaleY(data.offset-data.prefectures[e.prefecture].code),d3.line()([[x1,y],[x2,y]])}function drawFirstday(e){d3.select("svg#chart").append("g").attr("class","firstdays").selectAll("circle.firstday").data(e).join("circle").attr("class",e=>data.haplotypes.emerged.includes(e)?"firstday emerged":"firstday traced").attr("haplotype",e=>e.haplotype).attr("r",data.nodeR).attr("cx",e=>data.scaleX(e.firstday)-data.canvas.magic).attr("cy",e=>data.scaleY(data.offset-data.prefectures[e.prefecture].code)).style("fill",e=>data.pallet(e.haplotype)).on("click",e=>toggleHaplotype(e.haplotype)).on("mouseover",showInfobox),d3.selectAll(".firstday").style("fill",e=>data.pallet(e.haplotype))}function drawLastday(e){d3.select("svg#chart").append("g").attr("class","lastdays").selectAll("circle.lastday").data(e).join("circle").attr("class",e=>data.haplotypes.emerged.includes(e)?"lastday emerged":"lastday traced").attr("haplotype",e=>e.haplotype).attr("r",data.nodeR).attr("cx",e=>data.scaleX(e.lastday)-data.canvas.magic).attr("cy",e=>data.scaleY(data.offset-data.prefectures[e.prefecture].code)).on("click",e=>toggleHaplotype(e.haplotype)).on("mouseover",showInfoboxDuration),d3.selectAll(".lastday").style("fill",e=>data.pallet(e.haplotype))}function drawLineage(){wipeLineage(),d3.select("svg#chart").append("g").attr("class","lineages");for(let e of data.haplotypes.visible){const t=e.replace(/\.[^.]+$/,"");if(t!=e){const s=data.haplotypes.emerged.filter(t=>t.haplotype==e).shift(),n=data.haplotypes.emerged.filter(e=>e.haplotype==t).shift();if(n){const e=[n,s];d3.select("svg#chart").select(".lineages").append("path").datum(e).join("path").attr("class","lineage").attr("fill","none").attr("stroke",d3.rgb("#666666")).attr("stroke-dasharray","1, 4").attr("d",haploline(e)),checkSelector("#lineage")&&!data.haplotypes.visible.includes(n.haplotype)&&data.haplotypes.visible.push(n.haplotype)}}}toggleLineage()}function wipeLineage(){wipeSelector(".lineages")}function drawTrace(){wipeTrace(),d3.select("svg#chart").append("g").attr("class","traces");for(let t of data.haplotypes.visible){let e=data.points.filter(e=>e.haplotype==t);e.length>1&&d3.select("svg#chart").select(".traces").append("path").datum(e).join("path").attr("class","trace").attr("haplotype",e=>e.haplotype).attr("fill","none").attr("stroke",d3.rgb("#cccccc")).attr("d",haploline(e))}toggleTrace()}function wipeTrace(){wipeSelector(".traces")}function haploline(){return d3.line().x(e=>data.scaleX(e.firstday)-data.canvas.magic).y(e=>data.scaleY(data.offset-data.prefectures[e.prefecture].code))}function showInfobox(e){data.haplotypes.visible.includes(e.haplotype)&&(d3.select("#infobox-haplotype-label").text(data.wavename+":"+e.haplotype),data.lang=="en"?d3.select("#infobox-haplotype-prefecture").text(data.prefectures[e.prefecture].name):d3.select("#infobox-haplotype-prefecture").text(data.prefectures[e.prefecture].label),d3.select("#infobox-haplotype-firstday").text(d3.timeFormat("%Y-%m-%d")(e.firstday)),d3.select("#infobox-haplotype-lastday").text(d3.timeFormat("%Y-%m-%d")(e.lastday)),d3.select("#infobox-haplotype-duration").text(`${e.duration} day(s)`),d3.select("#infobox-haplotype-total").text(`${e.total} seq(s)/pref`))}function showInfoboxDuration(e){checkSelector("#duration")&&showInfobox(e)}function changeResolution(){let e=this.id;data.resolutions.map(t=>{t.id==e?(d3.select(`#${t.id}`).classed("btn-primary",!0).classed("btn-secondary",!1),data.canvas=t.canvas):d3.select(`#${t.id}`).classed("btn-primary",!1).classed("btn-secondary",!0)}),setup()}function showResolutionHint(){d3.select("#resolution-hint").style("display","block")}function hideResolutionHint(){d3.select("#resolution-hint").style("display","none")}function showSelector(e){d3.selectAll(e).classed("show",!0).classed("hide",!1)}function hideSelector(e){d3.selectAll(e).classed("show",!1).classed("hide",!0)}function wipeSelector(e){d3.selectAll(e).remove()}function checkSelector(e){return d3.select(e).property("checked")}function dumpSVG(e){const t=d3.select("style").html();e.select("svg").append("style").html(t);const n=e.html();return n}function downloadSVG(e){const t=new Blob([e],{type:"data:image/svg+xml;base64"}),n=window.URL.createObjectURL(t),s="haplograph-"+d3.timeFormat("%Y%m%d-%H%M%S")(new Date)+".svg";d3.select("#download-link").attr("download",s).attr("href",n)}function downloadGenomeSVG(){downloadSVG(dumpSVG(d3.select("#container-genome")))}function downloadChartSVG(){downloadSVG(dumpSVG(d3.select("#container-chart")))}</script><style>text{font-family:sans-serif;font-size:7pt}.label{font-size:9pt;text-anchor:middle}.domain{opacity:0}.axis-x line,.axis-y line{stroke-width:.25}.axis-x-grid line,.axis-y-grid line{stroke-width:.25;opacity:.3}.area{opacity:.2}.show{opacity:1}.hide{opacity:0}.haplotip{pointer-events:none}.haplotip text{font-size:10pt}.haplotip rect{fill:#eee;fill-opacity:.7;stroke:#eee;stroke-opacity:.7}.app-align{padding-top:.6em}.resolution-icon{font-size:1.4em}</style></head><body><nav class="navbar navbar-light bg-light"><div class=container-fluid><form class=d-flex><div class=navbar-brand><i class=bi-bar-chart-steps style=font-size:1.4rem></i>
SARS-CoV-2 HaploGraph</div><div class="dropdown form-check-inline"><button class="btn btn-secondary dropdown-toggle" type=button id=dropdown-dataset data-bs-toggle=dropdown aria-expanded=false>
<i class=bi-file-earmark-text-fill style=font-size:1.2rem></i>
Dataset</button><ul class=dropdown-menu aria-labelledby=dropdown-dataset style=opacity:.8><li><select id=dataset class=form-select style=border:none;padding:10px size=4></select></li></ul></div><div class=navbar-brand><span class=text-secondary id=dataname>dataname</span></div></form><form class=d-flex><div class="dropdown form-check-inline"><button class="btn btn-primary dropdown-toggle" type=button id=dropdown-haplotype data-bs-toggle=dropdown aria-expanded=false>
<i class=bi-node-plus-fill style=font-size:1.2rem></i>
Haplotypes</button><ul class=dropdown-menu aria-labelledby=dropdown-haplotype style=opacity:.8><li><div class=info style=margin:10px><i class="bi-info-circle-fill info" style=color:#007bff></i>
Multiple choice:<br><i class=bi-apple style=color:#6c757d>Cmd</i> + <i class=bi-mouse2 style=color:#6c757d>Click</i><br><i class=bi-windows style=color:#6c757d>Ctrl</i> + <i class=bi-mouse2 style=color:#6c757d>Click</i></div><select id=haplotype class=form-select style=border:none;padding:10px size=20 multiple></select></li></ul></div><div class="form-check form-check-inline form-switch app-align"><input type=checkbox id=trace class=form-check-input checked>
<label class=form-check-label for=trace>Trace</label></div><div class="form-check form-check-inline form-switch app-align"><input type=checkbox id=duration class=form-check-input>
<label class=form-check-label for=duration>Duration</label></div><div class="btn-group form-check-inline" role=group aria-label=help-lang><button type=button class="btn btn-outline-primary btn-sm lang-button" id=lang>
<i class="bi-globe lang-icon"></i>
</button>
<button type=button class="btn btn-outline-primary btn-sm help-button" id=help>
<a href=https://ktym.github.io/covid19/help-ja target=_blank id=help-link><i class="bi-question-circle help-icon"></i></a></button></div></form></div></nav><div style=overflow-x:scroll id=container-genome><svg id="genome"/></div><div id="infobox-haplotype" class="btn-group" role="group" aria-label="Infobox haplotype" style="margin:10px"><button type="button" class="btn btn-outline-secondary">Haplotype<span id="infobox-haplotype-label" class="badge bg-light text-dark"/></button><button type="button" class="btn btn-outline-secondary">Prefecture<span id="infobox-haplotype-prefecture" class="badge bg-light text-dark"/></button><button type="button" class="btn btn-outline-secondary">First day<span id="infobox-haplotype-firstday" class="badge bg-light text-dark"/></button><button type="button" class="btn btn-outline-secondary">Last day<span id="infobox-haplotype-lastday" class="badge bg-light text-dark"/></button><button type="button" class="btn btn-outline-secondary">Duration<span id="infobox-haplotype-duration" class="badge bg-light text-dark"/></button><button type="button" class="btn btn-outline-secondary">Total<span id="infobox-haplotype-total" class="badge bg-light text-dark"/></button></div><div style="overflow-x:scroll" id="container-chart"><svg id="chart"/></div></body></div></main></div><p id="pageTop"><a href="#"><img src="https://ddbj.github.io/pathogens/img/circle-arrowtoTop.png"/></p><footer class="container border-top mt-4"><div class="row border-bottom pt-3 pb-2"><div class="col-md px-5 px-md-2"><h2 class="small text-uppercase text-muted" style="font-size:.875em">About</h2><ul class="list-unstyled mb-1"><li><a href="https://ddbj.github.io/pathogens/news/">Portal news</a></li><li><a href="https://ddbj.github.io/pathogens/about/supportfeedback/">お問い合わせ</a></li></ul></div><div class="col-md px-5 px-md-2"><h2 class="small text-uppercase text-muted" style="font-size:.875em">Connect</h2><div><a class="ps-2" style="font-size:1.9em" target="_blank" aria-label="Contact email link" href="mailto:mail@example.com"><i class="bi bi-envelope-fill"/></a></div></div></div><div class="container"><div class="row footer-contents"><div class="footer-logo col-md-2"><a href="https://rcos.nii.ac.jp/" target="_blank"><img src="https://ddbj.github.io/pathogens/img/footer_logo.png" alt="国立情報学研究所 オープンサイエンス基盤研究センター"/></div><div class="footer-address col-md-6">国立情報学研究所オープンサイエンス基盤研究センター<br>〒101-8430 東京都千代田区一ツ橋2-1-2<br>rcos-office＠nii.ac.jp<a style="color:#838384">※@を半角に変えて送信ください</a></div><div class="footer-share col-md-4"><div class="share"><div class="twitter"><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-hashtags="RCOS" data-show-count="false">Tweet</a><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"/></div><div class="fb-like fb_iframe_widget" data-href="#" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="false" fb-xfbml-state="rendered" fb-iframe-plugin-query="action=like&amp;app_id=&amp;container_width=0&amp;href=https%3A%2F%2Frcos.nii.ac.jp%2F%23&amp;layout=button_count&amp;locale=ja_JP&amp;sdk=joey&amp;share=false&amp;show_faces=false&amp;size=small"><span style="vertical-align:bottom;width:91px;height:20px"><iframe name="f29e0af871a27d" width="1e3" height="1e3" data-testid="fb:like Facebook Social Plugin" title="fb:like Facebook Social Plugin" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="https://www.facebook.com/v2.10/plugins/like.php?action=like&amp;app_id=&amp;channel=https%3A%2F%2Fstaticxx.facebook.com%2Fx%2Fconnect%2Fxd_arbiter%2F%3Fversion%3D46%23cb%3Df2412f7cc9f4fe%26domain%3Drcos.nii.ac.jp%26origin%3Dhttps%253A%252F%252Frcos.nii.ac.jp%252Ff1a38ae8197c9b8%26relation%3Dparent.parent&amp;container_width=0&amp;href=https%3A%2F%2Frcos.nii.ac.jp%2F%23&amp;layout=button_count&amp;locale=ja_JP&amp;sdk=joey&amp;share=false&amp;show_faces=false&amp;size=small" style="border:none;visibility:visible;width:91px;height:20px" class=""/></span></div></div><div class="contact-policy"><a href="https://ddbj.github.io/pathogens/about/supportfeedback/" style="margin-right:30px">お問い合わせ</a><a href="https://www.nii.ac.jp/policy/" target="_blank">プライバシーポリシー</a></div></div></div></div><div class="foot-copy"><a href="http://www.nii.ac.jp/">© 2020 National Institute of Informatics</a></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"/></body></html>